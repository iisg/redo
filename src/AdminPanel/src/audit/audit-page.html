<template>
    <require from="resources/details/resource-link"></require>
    <require from="common/value-converters/date-value-converter"></require>
    <require from="common/components/pagination/pagination"></require>
    <require from="./filters/audit-command-name-chooser"></require>
    <require from="./filters/resource-contents-yaml-filter"></require>
    <require from="./underscores-to-hyphens"></require>

    <div class="audit-page">
        <div>
            <span class="page-title">${'Filters' | t}</span>

            <div class="form-group">
                <label>${ 'Operation' | t}</label>
                <audit-command-name-chooser command-names.bind="filters.commandNames"></audit-command-name-chooser>
            </div>
            <resource-contents-yaml-filter value.bind="filters.resourceContents"></resource-contents-yaml-filter>

            <div class="form-group">
                <button class="btn btn-primary"
                    click.delegate="onFiltersChanged()">
                    <icon name="filter-2"></icon>
                    ${ 'Filter_verb' | t }
                </button>
            </div>
        </div>

        <pagination total-number-of-elements.bind="entries.total"
            elements-per-page.bind="filters.resultsPerPage"
            current-page-number.bind="filters.currentPageNumber"
            hide-elements-per-page-dropdown="true"
            if.bind="entries.length"></pagination>

        <loading-bar if.bind="displayProgressBar"></loading-bar>

        <div class="alert alert-danger"
            if.bind="error">
            <strong>${ 'Invalid audit filters.' | t }</strong>
            <span if.bind="error.statusCode == 404">
                ${ 'Could not find metadata' | t }
                ${ error.content.params.query }
            </span>
        </div>

        <table if.bind="entries.length > 0">
            <thead>
            <tr>
                <th>${'Date' | t}</th>
                <th>${'Operation' | t}</th>
                <th>${'User' | t}</th>
                <th>${'Details' | t}</th>
            </tr>
            </thead>
            <tbody>
            <tr repeat.for="entry of entries"
                class="${entry.successful ? '' : 'failure'}">
                <td>${entry.createdAt | date:'LLL'}</td>
                <td>${'audit_commands::' + entry.commandName | t}</td>
                <td>
                    <resource-link if.bind="entry.user"
                        id.bind="entry.user.userData.id"></resource-link>
                </td>
                <td>
                    <compose view-model="./entry-details/audit-entry-details"
                        view="./entry-details/audit-entry-details-${entry.commandName | underscoresToHyphens}.html"
                        model.bind="{entry: entry}"></compose>
                </td>
            </tr>
            </tbody>
        </table>

        <div class="alert alert-info"
            if.bind="entries.length === 0 && !displayProgressBar && !error">
            <icon name="information"></icon>
            ${ 'No entry matches given filters.' | t }
        </div>

        <pagination total-number-of-elements.bind="entries.total"
            elements-per-page.bind="filters.resultsPerPage"
            current-page-number.bind="filters.currentPageNumber"
            if.bind="entries.length"></pagination>
    </div>
</template>
