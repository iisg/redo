<template>
    <require from="../add/resource-form"></require>
    <require from="../workflow/resource-workflow"></require>
    <require from="./apply-transition-button/apply-transition-button"></require>
    <require from="./resource-metadata-table/resource-metadata-table"></require>
    <require from="../resources-list"></require>
    <require from="common/components/buttons/remove-button"></require>
    <require from="common/components/buttons/edit-button"></require>
    <require from="users/details/user-roles-assign"></require>
    <require from="users/details/user-groups"></require>

    <loading-bar if.bind="!resource"></loading-bar>

    <div else
        class="resource-details au-animate fade-inup-outup">
        <div class="resource-name-with-buttons-and-tabs">
            <span class="page-title">${resource | resourceDisplayStrategy:'header'}</span>
            <template if.bind="currentTabId !== 'workflow-tab' && !editing">
                <apply-transition-button repeat.for="transition of resource.availableTransitions"
                    resource.bind="resource"
                    transition.bind="transition"
                    can-apply-transition.bind="resource.canApplyTransition(transition)"
                    click.trigger="toggleEditForm(true, transition)"></apply-transition-button>
            </template>
            <remove-button if.bind="!editing"
                disabled.bind="resource.pendingRequest"
                on-click.call="remove()"></remove-button>
            <div if.bind="resource.pendingRequest">
                <throbber></throbber>
            </div>
            <aup-tabs tabs.bind="resourceDetailsTabs"></aup-tabs>
        </div>
        <aup-tab-content>
            <aup-tab-pane tab="child-resource-tab">
                <div if.bind="currentTabId === 'child-resource-tab'">
                    <resources-list parent-resource.bind="resource"
                        has-resources.bind="hasChildren"></resources-list>
                </div>
            </aup-tab-pane>
            <aup-tab-pane tab="metadata-tab">
                <div if.bind="currentTabId === 'metadata-tab'">
                    <template if.bind="!editing">
                        <resource-metadata-table resource.bind="resource"></resource-metadata-table>
                        <edit-button toggled.bind="editing"
                            disabled.bind="resource.pendingRequest"
                            on-click.call="toggleEditForm(false)"></edit-button>
                    </template>
                    <resource-form else
                        resource-class.bind="resource.resourceClass"
                        edit.bind="resource"
                        submit.call="saveEditedResource(savedResource, transitionId)"
                        cancel.call="toggleEditForm()"></resource-form>
                </div>
            </aup-tab-pane>
            <aup-tab-pane tab="workflow-tab">
                <div if.bind="currentTabId === 'workflow-tab'">
                    <div>
                        <apply-transition-button repeat.for="transition of resource.availableTransitions"
                            resource.bind="resource"
                            transition.bind="transition"
                            can-apply-transition.bind="resource.canApplyTransition(transition)"
                            click.trigger="toggleEditForm(true, transition)"></apply-transition-button>
                    </div>
                    <resource-workflow resource.bind="resource"></resource-workflow>
                </div>
            </aup-tab-pane>
            <aup-tab-pane tab="user-groups-tab">
                <user-groups if.bind="currentTabId === 'user-groups-tab'"
                    user-data.bind="resource"></user-groups>
            </aup-tab-pane>
            <aup-tab-pane tab="user-roles-tab">
                <user-roles-assign if.bind="currentTabId === 'user-roles-tab'"
                    user-data.bind="resource"></user-roles-assign>
            </aup-tab-pane>
        </aup-tab-content>
    </div>
</template>
