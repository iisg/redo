<template>
    <require from="common/components/resource-kind/resource-kind-chooser/resource-kind-chooser"></require>
    <require from="./resource-form-generated"></require>
    <require from="../metadata/required-metadata-list"></require>
    <require from="workflows/details/transitions/workflow-froms-tos-display"></require>
    <require from="../workflow/transition-button"></require>

    <div>
        <div class="row">
            <div if.bind="showRequiredMetadataAndWorkflowInfo"
                class="col-md-4">
                <workflow-froms-tos-display transition.bind="transition"
                    places.bind="resource.kind.workflow.places"
                    resource-class.bind="resourceClass"></workflow-froms-tos-display>
            </div>
            <div if.bind="showRequiredMetadataAndWorkflowInfo"
                class="col-md-4">
                <required-metadata-list if.bind="requiredMetadataIds.length > 0"
                    resource-class.bind="resourceClass"
                    required-metadata-ids.bind="resource.kind ? requiredMetadataIds : []"></required-metadata-list>
            </div>
            <div class="${showRequiredMetadataAndWorkflowInfo ? 'col-md-4' : 'col-md-12'}">
                <div class="pull-right button-parent"
                    if.bind="resource.kind !== undefined">
                    <button class="btn"
                        type="button"
                        click.trigger="openImportDialog()"
                        bootstrap-tooltip.bind="'Import data from KOHA' | t">
                        <icon name="koha"></icon>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <form submit.delegate="saveResource()">
        <div class="form-group"
            if.bind="!editing">
            <resource-kind-chooser resource-class.bind="resourceClass"
                filter.one-time="isAllowedByParentFilter()"
                value.bind="resource.kind & validate"></resource-kind-chooser>
        </div>
        <div class="form-group"
            if.bind="resource.kind">
            <resource-form-generated resource-kind.bind="resource.kind"
                resource.bind="resource"
                validation-controller.bind="validationController"
                contents-validation.bind="resource.contents & validate"
                parent.bind="parent"
                resource-class.bind="resourceClass"
                required-metadata-ids-for-transition.bind="resource.kind ? requiredMetadataIds : []"></resource-form-generated>
        </div>
        <div class="form-group text-right">
            <span class="text-danger"
                if.bind="hasValidationError">
                ${'Some metadata constraints have not been met. Check the form error and try again.' | t}
            </span>
            <div class="btn-group">
                <submit-button class="resource-form-button"
                    submitting.bind="submitting"
                    editing.bind="editing"></submit-button>
                <transition-button class="resource-form-button"
                    if.bind="editing && transition"
                    submitting.bind="submitting"
                    can-apply-transition.bind="canApplyTransition"
                    apply-transition.call="applyTransition()"
                    transition.bind="transition"
                    places.bind="edit.kind.workflow.places"></transition-button>
            </div>
        </div>
    </form>
</template>
