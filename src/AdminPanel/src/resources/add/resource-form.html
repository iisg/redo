<template>
    <require from="common/components/resource-kind/resource-kind-chooser/resource-kind-chooser"></require>
    <require from="common/components/buttons/icon-button"></require>
    <require from="common/components/buttons/toggle-button"></require>
    <require from="./resource-form-generated"></require>
    <require from="../metadata/required-metadata-list"></require>
    <require from="workflows/details/transitions/workflow-froms-tos-display"></require>
    <require from="../workflow/transition-button"></require>

    <span if.bind="!editing"
        class="page-title">${'Add new resource' | resourceClassTranslation:resourceClass}</span>
    <workflow-froms-tos-display if.bind="showRequiredMetadataAndWorkflowInfo"
        transition.bind="transition"
        places.bind="resource.kind.workflow.places"
        resource-class.bind="resourceClass"></workflow-froms-tos-display>
    <required-metadata-list if.bind="showRequiredMetadataAndWorkflowInfo && requiredMetadataIds.length > 0"
        resource-class.bind="resourceClass"
        required-metadata-ids.bind="resource.kind ? requiredMetadataIds : []"></required-metadata-list>
    <div if.bind="resource.kind !== undefined">
        <icon-button icon-name="koha"
            tooltip-text-when-enabled="${'Import data from KOHA' | t}"
            on-click.call="openImportDialog()">
        </icon-button>
    </div>
    <span if.bind="validationError"
        class="error-label">${'Some metadata constraints have not been met. Check the form error and try again.' | t}</span>
    <form submit.delegate="saveResource()">
        <resource-kind-chooser if.bind="!editing"
            resource-class.bind="resourceClass"
            filter.one-time="createResourceKindFilter()"
            value.bind="resource.kind & validate"></resource-kind-chooser>
        <div if.bind="resource.kind"
            class="form-with-buttons">
            <resource-form-generated class="form-content"
                resource-kind.bind="resource.kind"
                resource.bind="resource"
                validation-controller.bind="validationController"
                contents-validation.bind="resource.contents & validate"
                parent.bind="parent"
                resource-class.bind="resourceClass"
                target-places.bind="targetPlaces"
                required-metadata-ids-for-transition.bind="resource.kind ? requiredMetadataIds : []"></resource-form-generated>
            <div class="form-buttons">
                <transition-button if.bind="editing && transition"
                    submitting.bind="submitting"
                    apply-transition.call="applyTransition()"
                    transition.bind="transition"
                    places.bind="edit.kind.workflow.places"></transition-button>
                <submit-button if.bind="!transition"
                    submitting.bind="submitting"
                    editing.bind="editing"
                    secondary-label="Save"></submit-button>
                <toggle-button if.bind="editing"
                    primary-icon-name="remove-3"
                    primary-label="Cancel"
                    disabled.bind="submitting || resource.pendingRequest"
                    on-click.call="cancel()"></toggle-button>
            </div>
        </div>
    </form>
</template>
