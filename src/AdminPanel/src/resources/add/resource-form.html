<template>
    <require from="common/components/resource-kind/resource-kind-chooser/resource-kind-chooser"></require>
    <require from="common/components/workflow/workflow-place-chooser/workflow-place-chooser"></require>
    <require from="common/components/buttons/toggle-button"></require>
    <require from="./resource-form-generated"></require>
    <require from="workflows/details/transitions/workflow-froms-tos-display"></require>
    <require from="../workflow/transition-button"></require>
    <require from="common/components/buttons/cancel-button.html"></require>
    <require from="common/components/buttons/submit-button.html"></require>

    <span if.bind="transition"
        class="page-title">
        ${'Edit resource before transition' | resourceClassTranslation:resourceClass}</span>
    <div if.bind="!editing || skipValidation"
        class="resource-kind-chooser-with-cancel-button">
        <resource-kind-chooser
            resource-class.bind="resourceClass"
            filter.one-time="createResourceKindFilter()"
            value.bind="resource.kind & validate"></resource-kind-chooser>
        <cancel-button if.bind="!resource.kind"
            class="orange"
            label="Close"
            click.delegate="cancel()"></cancel-button>
    </div>
    <div if.bind="skipValidation && resource.kind.workflow"
        class="workflow-place-chooser-container">
        <p>${'Places in workflow' | t}:</p>
        <workflow-place-chooser workflow-places.bind="resource.kind.workflow.places"
            value.bind="places"></workflow-place-chooser>
    </div>
    <workflow-froms-tos-display if.bind="showRequiredMetadataAndWorkflowInfo"
        transition.bind="transition"
        places.bind="resource.kind.workflow.places"
        resource-class.bind="resourceClass"></workflow-froms-tos-display>

    <template if.bind="resource.kind">
        <toggle-button primary-icon-name="koha"
            primary-label="Import data from KOHA"
            click.delegate="openImportDialog()"></toggle-button>
        <span if.bind="validationError"
            class="error-label">${'Some metadata constraints have not been met. Fix the form errors and try again.' | t}</span>
        <form class="form-with-buttons"
            submit.delegate="validateAndSubmit()">
            <resource-form-generated class="form-content"
                change.delegate="dirty = true"
                resource-kind.bind="resource.kind"
                resource.bind="resource"
                parent.bind="parent"
                skip-validation.bind="skipValidation"
                validation-controller.bind="validationController"
                contents-validation.bind="resource.contents & validate"
                target-places.bind="targetPlaces"
                required-metadata-ids-for-transition.bind="resource.kind ? requiredMetadataIds : []"></resource-form-generated>
            <div class="form-buttons">
                <transition-button if.bind="editing && transition"
                    transition.bind="transition"
                    places.bind="currentlyEditedResource.kind.workflow.places"
                    submitting.bind="submitting"></transition-button>
                <submit-button if.bind="!transition"
                    editing.bind="editing"
                    submitting.bind="submitting">
                    ${(editing ? 'Save' : 'Add') | t}
                </submit-button>
                <cancel-button class.bind="editing ? '' : 'orange'"
                    label="Close"
                    disabled.bind="resource.pendingRequest || submitting"
                    click.delegate="cancel()"></cancel-button>
            </div>
        </form>
    </template>
</template>
