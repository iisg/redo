<template>
    <require from="resources/controls/input/resource-picker/resource-picker"></require>
    <require from="common/value-converters/to-array-value-converter"></require>
    <require from="resources/details/resource-link"></require>

    <template if.bind="metadataValue.value">
        <resource-link id.bind="metadataValue.value"></resource-link>
    </template>

    <template else>
        <resource-picker resource-id.bind="metadataValue.value & validate:validationController:validationRules"
            resource-kind-ids.bind="skipValidation ? [] : metadata.constraints.resourceKind"
            contents-filter.bind="skipValidation ? undefined : metadata.constraints.relatedResourceMetadataFilter"
            resource-class.bind="!skipValidation && metadata.id == -1 ? resource.resourceClass : undefined"
            disabled.bind="disabled || (metadata.constraints.resourceKind.length === 0 && !skipValidation)"></resource-picker>

        <span if.bind="!skipValidation && metadata.constraints.resourceKind.length === 0">
            ${'To see dropdown choose allowed resource kinds in metadata settings.' | t}
            <a route-href="route: metadata/details; params.bind: {id: metadata.id, action: 'edit'}"
                if.bind="'ADMIN' | hasRole:metadata.resourceClass">
                ${'Go to the metadata kind settings' | t}
            </a>
        </span>
        <span show.bind="relatedResourceMetadataFilterInfo.filters.length > 0"
            ref="relatedResourceMetadataFilterInfo"
            filters.bind="metadata.constraints.relatedResourceMetadataFilter | toArray">
            <span if.bind="skipValidation">${'Additional filter would limit results in this dropdown during normal edit' | t}:</span>
            <span else>${'Additional filter limits results in this dropdown' | t}:</span>
            <strong>${relatedResourceMetadataFilterInfo.filters[0].value}</strong>
            <a route-href="route: metadata/details; params.bind: {id: metadata.id, action: 'edit'}"
                if.bind="'ADMIN' | hasRole:metadata.resourceClass">
                ${'Go to the metadata kind settings' | t}
            </a>
        </span>
    </template>
</template>
