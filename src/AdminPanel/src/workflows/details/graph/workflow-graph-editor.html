<template>
    <require from="../graph/workflow-graph-display"></require>
    <require from="./workflow-plugins-configuration"></require>

    <div class="btn-group pull-right">
        <button type="button"
            class="btn btn-default ${simulating ? 'active' : ''}"
            if.bind="workflow.places.length > 0"
            click.delegate="toggleSimulation()">
            <icon name.bind="simulating ? 'square' : 'back-3'"
                rotation.bind="simulating ? 0 : 180"></icon>
            ${ 'Simulation' | t }
        </button>
    </div>

    <div class="col-sm-12 hidden-xs workflow-editor">
        <div class="row">
            <div class="col-sm-9 no-padding">
                <loading-bar if.bind="graph.isProcessingWorkflowPlaceRemoval"></loading-bar>
                <workflow-graph-display workflow.bind="workflow"
                    editable.bind="!simulating"
                    current.bind="currentSimulationPlaces"
                    workflow-graph-ready.delegate="onGraphBuilt($event)"></workflow-graph-display>
            </div>
            <div class="col-sm-3 no-padding">
                <div class="well"
                    if.bind="!simulating">
                    <span if.bind="!selectedElement">${ 'Select any element on the diagram to edit' | t }</span>
                    <span if.bind="selectedElement">
                        <h3>
                            <span if.bind="!selectedElement.froms">${ 'Place' | t }</span>
                            <span if.bind="selectedElement.froms">${ 'Transition' | t}</span>
                        </h3>
                        <form submit.delegate="saveSelectedElementChanges()">
                            <div class="form-group">
                                <span>${'Label' | t}</span>
                                <multilingual-editor class="vertical"
                                    keyup.delegate="saveSelectedElementChanges()"
                                    value.bind="selectedElement.label"
                                    change.delegate="signalWorkflowPlacesUpdated()"></multilingual-editor>
                            </div>
                            <div class="form-group"
                                if.bind="!selectedElement.froms">
                                <workflow-plugins-configuration config.bind="selectedElement.pluginsConfig"
                                    workflow.bind="workflow"
                                    if.bind="workflow.id"
                                    change.delegate="saveSelectedElementChanges()"></workflow-plugins-configuration>
                                <em else>${ 'Save the workflow in order to configure workflow plugins.' | t }</em>
                            </div>
                        </form>
                    </span>
                </div>
                <div class="well"
                    if.bind="simulating">
                    <h3>${ 'Choose the next transition' | t}</h3>
                    <loading-bar if.bind="fetchingTransitions"></loading-bar>
                    <div class="btn-group-vertical au-animate fade-inup-outup btn-block"
                        if.bind="!fetchingTransitions">
                        <button type="button"
                            class="btn btn-success btn-block"
                            click.delegate="advanceSimulation(transition.id)"
                            repeat.for="transition of availableTransitions">
                            <span ref="transition.translatedLabel"
                                value.one-time="transition.label | inCurrentLanguage">
                                <span if.one-time="transition.translatedLabel.value">
                                    ${ transition.translatedLabel.value }
                                </span>
                                <span if.one-time="!transition.translatedLabel.value">
                                    <em>${ 'Transition' | t } #${ $index + 1 }</em>
                                </span>
                            </span>
                        </button>
                    </div>
                    <div if.bind="!fetchingTransitions && availableTransitions.length === 0">
                        ${ 'No transitions from current place.' | t }
                        <button type="button"
                            class="btn btn-warning btn-block"
                            click.delegate="toggleSimulation()">
                            ${ 'End simulation' | t }
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>
