<template>
    <require from="./metadata-form"></require>
    <require from="./details/metadata-child-add"></require>
    <require from="common/components/buttons/add-button.html"></require>

    <div>
        <add-button if.bind="!addFormOpened"
            entity-name="metadata"
            toggled.two-way="addFormOpened"></add-button>
        <div if.bind="addFormOpened"
            class="well add-form au-animate fade-inout-updown">
            <template if.bind="!parentMetadata">
                <span>${'Add new metadata kind' | resourceClassTranslation:resourceClass}</span>
                <metadata-form submit.call="addNewMetadata(editedMetadata)"
                    cancel.call="addFormOpened = false"
                    resource-class.bind="resourceClass"></metadata-form>
            </template>
            <template else>
                <span>${'Add submetadata kind' | t}</span>
                <metadata-child-add parent-metadata.bind="parentMetadata"
                    saved.call="metadataAdded(savedMetadata)"
                    cancel.call="addFormOpened = false"
                    resource-class.bind="resourceClass"></metadata-child-add>
            </template>
        </div>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>${'Name' | t}</th>
                    <th>${'Label' | t}</th>
                    <th>${'Control' | t}</th>
                    <th>${'Hint' | t}</th>
                    <th>${'Description' | t}</th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tfoot>
                <tr if.bind="progressBar">
                    <th colspan="8">
                        <loading-bar></loading-bar>
                    </th>
                </tr>
            </tfoot>
            <tbody oa-sortable="items.bind: metadataList; allow-drag.call: isDragHandle($event); on-stop.call: onOrderChanged();">
                <tr repeat.for="metadata of metadataList"
                    oa-sortable-item="item.bind: metadata"
                    go-to-link-on-row-click>
                    <td>
                        <a route-href="route: metadata/details; params.bind: {id: metadata.id}"
                        disabled-link.bind="metadata.pendingRequest">${metadata.id}</a>
                    </td>
                    <td>
                        <a route-href="route: metadata/details; params.bind: {id: metadata.id}"
                            disabled-link.bind="metadata.pendingRequest">${metadata.name}</a>
                        <icon name="show"
                            if.bind="metadata.shownInBrief"></icon>
                        <icon name="edit"
                            if.bind="metadata.copyToChildResource"></icon>
                    </td>
                    <td>
                        <a route-href="route: metadata/details; params.bind: {id: metadata.id}"
                            disabled-link.bind="metadata.pendingRequest">${metadata.label | inCurrentLanguage}</a>
                    </td>
                    <td>
                        ${'controls::' + metadata.control | t}
                        <icon name="user-3"
                            if.bind="metadata.canDetermineAssignees"
                            bootstrap-tooltip.bind="'This metadata can be used to specify assignees' | t"></icon>
                    </td>
                    <td>
                        ${metadata.placeholder | inCurrentLanguage}
                    </td>
                    <td>
                        ${metadata.description | inCurrentLanguage}
                    </td>
                    <td class="with-buttons-container">
                        <div if.bind="!parentMetadata && metadata.id > 0">
                            <a class="drag-handle"
                                bootstrap-tooltip.bind="'Drag to change order' | t"
                                disabled-link.bind="metadata.pendingRequest"
                                data-placement="left">
                                <icon name="arrows"
                                    size="1.25"></icon>
                            </a>
                        </div>
                    </td>
                    <td class="with-throbber"><throbber if.bind="metadata.pendingRequest"></throbber></td>
                </tr>
            </tbody>
        </table>
        <div class="alert alert-info"
            if.bind="metadataList.length === 0 && !progressBar">
            <icon name="information"></icon>
            ${'No metadata kinds.' | resourceClassTranslation:resourceClass}
        </div>
    </div>
</template>
