<template>
    <require from="./resource-kind-form"></require>
    <require from="common/components/buttons/add-button"></require>

    <add-button entity-name="resourceKind"
        toggled.two-way="addFormOpened"></add-button>
    <div if.bind="addFormOpened"
        class="well fade-inup-outdown au-animate floating-form-full-width">
        <h2>${'Add new resource kind' | resourceClassTranslation:resourceClass}</h2>
        <resource-kind-form resource-class.bind="resourceClass"
            submit.call="addNewResourceKind(savedResourceKind)"></resource-kind-form>
    </div>

    <table show.bind="!resourceKinds || resourceKinds.length > 0">
        <thead>
            <tr>
                <th>${'ID' | t}</th>
                <th>${'Name' | t}</th>
                <th>${'Metadata Kinds' | resourceClassTranslation:resourceClass}</th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <tfoot>
            <tr if.bind="progressBar">
                <th colspan="5">
                    <loading-bar></loading-bar>
                </th>
            </tr>
        </tfoot>
        <tbody class="au-stagger">
            <tr repeat.for="resourceKind of resourceKinds"
                class="au-animate fade-inup-outdown ${resourceKind.editing ? 'edit-form' : ''}">
                <td>
                    ${resourceKind.id}
                </td>
                <td if.bind="!resourceKind.editing">
                    ${resourceKind.label | inCurrentLanguage}
                </td>
                <td if.bind="!resourceKind.editing">
                    <dl class="dl-horizontal">
                        <template repeat.for="metadata of resourceKind.metadataList">
                            <div if.bind="metadata.id > 0">
                                <dt>${metadata.name}</dt>
                                <dd>
                                    <span>${metadata.label | inCurrentLanguage}</span>
                                    <icon name="show"
                                        if.bind="metadata.shownInBrief"></icon>
                                    <icon name="edit"
                                        if.bind="metadata.copyToChildResource"></icon>
                                </dd>
                            </div>
                        </template>
                    </dl>
                </td>
                <td if.bind="!resourceKind.editing"
                    class="with-buttons-container">
                    <div>
                        <button if.one-time="resourceKind.workflow"
                            type="button"
                            click.trigger="displayWorkflowPreview(resourceKind)"
                            disabled.bind="resourceKind.pendingRequest">
                            <icon name="workflow-2"
                                size="1.25"></icon>
                        </button>
                        <button type="button"
                            click.trigger="resourceKind.editing = true"
                            disabled.bind="resourceKind.pendingRequest">
                            <icon name="edit-2"
                                size="1.25"></icon>
                        </button>
                        <button class="remove"
                            type="button"
                            click.trigger="deleteResourceKind(resourceKind)"
                            disabled.bind="resourceKind.pendingRequest || resourceKind.id < 0">
                            <icon name="remove-4"
                                size="1.25"></icon>
                        </button>
                    </div>
                </td>
                <td if.bind="resourceKind.editing"
                    colspan="3">
                    <div class="au-animate anim-height-inout-600">
                        <resource-kind-form resource-class.bind="resourceClass"
                            edit.bind="resourceKind"
                            submit.call="saveEditedResourceKind(resourceKind, savedResourceKind) && (resourceKind.editing = false)"
                            cancel.call="resourceKind.editing = false"></resource-kind-form>
                    </div>
                </td>
                <td class="with-throbber"><throbber if.bind="resourceKind.pendingRequest"></throbber></td>
            </tr>
        </tbody>
    </table>

    <div class="alert alert-info"
        if.bind="resourceKinds.length === 0 && !progressBar">
        <icon name="information"></icon>
        ${'No resource kinds.' | resourceClassTranslation:resourceClass}
    </div>

</template>
