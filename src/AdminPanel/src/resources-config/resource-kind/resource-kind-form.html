<template>
    <require from="./resource-kind-metadata-chooser"></require>
    <require from="./workflow-chooser"></require>
    <require from="./resource-kind-metadata-form"></require>
    <require from="../metadata/metadata-form"></require>

    <form submit.delegate="validateAndSubmit()">
        <div class="form-group no-margin-top">
            <multilingual-editor label="${'Name' | t}"
                value.bind="resourceKind.label & validate"></multilingual-editor>
        </div>
        <div class="form-group no-margin-top ${sortingMetadata ? 'sorting-enabled' : ''}">
            <div class="row">
                <div class="col-xs-12">
                    <button type="button"
                        class="btn pull-right ${sortingMetadata ? 'btn-primary' : 'btn-default'}"
                        click.delegate="sortingMetadata = !sortingMetadata"
                        disabled.bind="submitting"
                        show.bind="resourceKind.metadataList.length > 1">
                        <fa name="sort-amount-asc fw"></fa>
                        ${(sortingMetadata ? 'Changing order' : 'Change order') | t}
                    </button>
                </div>
            </div>
            <div class="row au-stagger"
                show.bind="editableMetadataList.length > 0"
                oa-sortable="items.bind: editableMetadataList; allow-drag.call: isSortingMetadata($event); axis: y">
                <div class="col-xs-12 resource-kind-form-metadata-item ${metadata.sortingClass} ${sortingMetadata ? 'vertically-sortable' : ''}"
                    repeat.for="metadata of editableMetadataList & validate"
                    oa-sortable-item="item.bind: metadata">
                    <div class="well"
                        if.bind="base(metadata) & signal:'base-metadata-fetched'">
                        <div class="btn-group pull-right top-right-buttons"
                            show.bind="!sortingMetadata">
                            <button class="btn btn-default btn-raised ${metadata.overwriteForm ? 'active' : ''}"
                                type="button"
                                click.delegate="metadata.overwriteForm = !metadata.overwriteForm">
                                <fa name="edit"></fa>
                            </button>
                            <button class="btn btn-danger btn-raised"
                                type="button"
                                click.delegate="removeMetadata(metadata)">
                                <fa name="times"></fa>
                            </button>
                        </div>
                        <h3>
                            <span class="pull-right fa fa-bars"
                                show.bind="sortingMetadata"></span>
                            ${base(metadata).name}
                            <fa name="thumb-tack"
                                class="small"
                                if.bind="metadata.shownInBrief"></fa>
                        </h3>
                        <resource-kind-metadata-form show.bind="!sortingMetadata && metadata.overwriteForm"
                            metadata.bind="metadata"
                            base-metadata.bind="base(metadata)"
                            editing.bind="editing"
                            resource-class.bind="resourceClass"></resource-kind-metadata-form>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group"
            show.bind="hasMetadataToChoose">
            <label>${'Add metadata kind' | t}</label>
            <resource-kind-metadata-chooser
                has-metadata-to-choose.bind="hasMetadataToChoose"
                value.bind="newMetadataBase"
                resource-kind.bind="resourceKind"
                resource-class.bind="resourceClass"></resource-kind-metadata-chooser>
        </div>
        <div class="form-group"
            if.bind="!editing">
            <label>${'Workflow' | t}</label>
            <workflow-chooser resource-class.bind="resourceClass" value.bind="resourceKind.workflow"></workflow-chooser>
        </div>
        <div class="form-group text-right no-margin-top">
            <div class="btn-group">
                <button type="button"
                    class="btn btn-warning"
                    click.delegate="cancel()"
                    if.bind="editing"
                    disabled.bind="submitting">
                    <fa name="times fw"></fa>
                    ${'Cancel' | t}
                </button>
                <submit-button submitting.bind="submitting"
                    editing.bind="editing"></submit-button>
            </div>
        </div>
    </form>
</template>
