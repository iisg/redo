<template>
    <require from="./resource-kind-metadata-chooser"></require>
    <require from="./resource-kind-form.css"></require>
    <require from="./resource-kind-metadata-form"></require>
    <require from="../metadata/metadata-form"></require>
    <require from="../metadata/metadata-editable-properties.html"></require>

    <form submit.delegate="validateAndSubmit()">
        <div class="form-group label-floating no-margin-top">
            <multilingual-editor label="${'Name' | t}"
                value.bind="resourceKind.label & validate"></multilingual-editor>
        </div>
        <div class="form-group no-margin-top ${sortingMetadata ? 'sorting-enabled' : ''}">
            <div class="row">
                <div class="col-xs-12">
                    <button type="button"
                        class="btn pull-right ${sortingMetadata ? 'btn-primary' : 'btn-default'}"
                        click.delegate="sortingMetadata = !sortingMetadata"
                        disabled.bind="submitting"
                        show.bind="resourceKind.metadataList.length > 1">
                        <span class="fa fa-sort-amount-asc fa-fw"></span>
                        ${(sortingMetadata ? 'Changing order' : 'Change order') | t}
                    </button>
                </div>
            </div>
            <div class="row au-stagger"
                show.bind="resourceKind.metadataList.length > 0"
                oa-sortable="items.bind: resourceKind.metadataList; allow-move.call: isSortingMetadata(); allow-drag.call: isSortingMetadata($event); axis: 'y'; scroll: document">
                <div class="col-xs-12 resource-kind-form-metadata-item ${metadata.sortingClass} ${sortingMetadata ? 'vertically-sortable' : ''}"
                    repeat.for="metadata of resourceKind.metadataList & validate"
                    oa-sortable-item="item.bind: metadata">
                    <div class="well">
                        <div class="btn-group pull-right top-right-buttons"
                            show.bind="!sortingMetadata">
                            <button class="btn btn-default btn-raised ${metadata.overwriteForm ? 'active' : ''}"
                                type="button"
                                click.delegate="metadata.overwriteForm = !metadata.overwriteForm">
                                <span class="fa fa-edit"></span>
                            </button>
                            <button class="btn btn-danger btn-raised"
                                type="button"
                                click.delegate="removeMetadata(metadata)">
                                <span class="fa fa-times"></span>
                            </button>
                        </div>
                        <h3>
                            <span class="pull-right fa fa-bars"
                                show.bind="sortingMetadata"></span>
                            ${metadata.base.name}
                        </h3>
                        <resource-kind-metadata-form show.bind="!sortingMetadata && metadata.overwriteForm"
                            metadata.bind="metadata"
                            base-metadata.bind="metadata.base"></resource-kind-metadata-form>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group"
            show.bind="hasMetadataToChoose">
            <label>${'Add next metadata kind' | t}</label>
            <resource-kind-metadata-chooser
                has-metadata-to-choose.bind="hasMetadataToChoose"
                change.delegate="addNewMetadata($event)"
                resource-kind.bind="resourceKind"></resource-kind-metadata-chooser>
        </div>
        <div class="form-group text-right no-margin-top">
            <div class="btn-group">
                <button type="button"
                    class="btn btn-warning"
                    click.delegate="cancel()"
                    if.bind="editing"
                    disabled.bind="submitting">
                    <span class="fa fa-fw fa-times"></span>
                    ${'Cancel' | t}
                </button>
                <button class="btn btn-primary"
                    disabled.bind="submitting">
                    <span class="fa fa-fw ${submitting ? 'fa-circle-o-notch fa-spin' : (editing ? 'fa-save' : 'fa-plus')}"></span>
                    ${editing ? 'Save' : 'Add' | t}
                </button>
            </div>
        </div>
    </form>
</template>
