<template>
    <require from="./resource-kind-metadata-chooser"></require>
    <require from="./workflow-chooser"></require>
    <require from="./resource-kind-metadata-form"></require>
    <require from="../metadata/metadata-form"></require>
    <require from="./move-up-or-down-buttons"></require>
    <require from="common/components/buttons/toggle-button"></require>
    <require from="common/components/buttons/edit-button"></require>
    <require from="common/components/buttons/remove-button"></require>
    <require from="./display-strategies/resource-display-strategies-form"></require>
    <require from="resources-config/metadata/constraint/resource-kind/resource-kind-constraint-editor"></require>

    <form submit.delegate="validateAndSubmit()"
        class="form-with-buttons">
        <div class="form-content">
            <div class="form-group">
                <multilingual-editor label="${'Name' | t}"
                    value.bind="resourceKind.label & validate"></multilingual-editor>
            </div>
            <div if.bind="originalMetadataList && (editableMetadataList.length === 0 || originalMetadata(editableMetadataList[0])) & signal:'original-metadata-changed'"
                class="form-group no-margin-top ${sortingMetadata ? 'sorting-enabled' : ''}">
                <div class="row">
                    <div class="col-xs-12">
                        <toggle-button if.bind="editableMetadataList.length > 1"
                            class="pull-right"
                            primary-icon-name="arrows"
                            primary-label="Change order"
                            secondary-icon-name="arrows"
                            secondary-label="Changing order"
                            toggled.bind="sortingMetadata"
                            disabled.bind="submitting"
                            on-click.call="sortingMetadata = !sortingMetadata"></toggle-button>
                    </div>
                </div>
                <div>
                    <div repeat.for="metadata of editableMetadataList & validate"
                    class="resource-kind-edit-form-metadata-item well">
                        <div>
                            <span class="metadata-name ${metadata.overwriteForm ? 'title' : ''}">${originalMetadata(metadata).name}</span>
                            <span class="metadata-id ${metadata.overwriteForm ? 'title' : ''}">ID: ${originalMetadata(metadata).id}</span>
                            <icon if.bind="metadata.shownInBrief"
                                name="show"></icon>
                            <icon if.bind="metadata.copyToChildResource"
                                name="edit"></icon>
                            <move-up-or-down-buttons if.bind="sortingMetadata"
                                show-up-button.bind="!$first"
                                show-down-button.bind="!$last"
                                up.delegate="moveUp(metadata)"
                                down.delegate="moveDown(metadata)"></move-up-or-down-buttons>
                            <div else
                                class="buttons">
                                <edit-button class="${metadata.overwriteForm ? 'active' : ''}"
                                    secondary-label="Close"
                                    toggled.bind="metadata.overwriteForm"
                                    on-click.call="metadata.overwriteForm = !metadata.overwriteForm"
                                    show-tooltips-instead-of-labels.bind="true"></edit-button>
                                <remove-button if.bind="canRemoveMetadata(metadata)"
                                    on-click.call="removeMetadata(metadata)"
                                    show-tooltips-instead-of-labels="true"></remove-button>
                            </div>
                        </div>
                        <resource-kind-metadata-form show.bind="!sortingMetadata && metadata.overwriteForm"
                            metadata.bind="metadata"
                            original-metadata.bind="originalMetadata(metadata)"
                            editing.bind="editing"
                            resource-class.bind="resourceClass"></resource-kind-metadata-form>
                    </div>
                </div>
            </div>
            <loading-bar else></loading-bar>
            <div class="form-group"
                show.bind="hasMetadataToChoose">
                <label>${'Add metadata kind' | resourceClassTranslation:resourceClass}</label>
                <resource-kind-metadata-chooser
                    has-metadata-to-choose.bind="hasMetadataToChoose"
                    value.bind="metadataToAdd"
                    resource-kind.bind="resourceKind"
                    should-refresh-results.bind="metadataListModified"></resource-kind-metadata-chooser>
            </div>
            <div class="form-group"
                if.bind="!hasWorkflowChosen">
                <label>${'Workflow' | resourceClassTranslation:resourceClass}</label>
                <workflow-chooser resource-class.bind="resourceClass"
                    value.bind="resourceKind.workflow"></workflow-chooser>
                <span class="help-block">
                    ${'Keep in mind that you can not change the workflow for resource kind after choosing it once. Select with care.' | t}
                </span>
            </div>
            <div class="form-group">
                <label>${'Available child resource kind' | t}</label>
                <resource-kind-constraint-editor metadata.bind="resourceChildConstraintMetadata"
                    resource-class.bind="resourceClass"></resource-kind-constraint-editor>
            </div>
            <div class="form-group">
                <resource-display-strategies-form resource-kind.bind="resourceKind"></resource-display-strategies-form>
            </div>
        </div>
        <div class="form-buttons">
            <submit-button editing.bind="editing"
                submitting.bind="submitting"></submit-button>
            <cancel-button disabled.bind="resourceKind.pendingRequest || submitting"
                on-click.call="cancel()"></cancel-button>
        </div>
    </form>
</template>
