{% set metadataToDisplay = cmsConfig('display_metadata_' ~ resource.kind.name ~ '_bibtex', cmsConfig('display_metadata_DEFAULT')) %}
{% set bibtexType = (resource | mBibtexType) is not empty ? (resource | mBibtexType) : '@misc' %}
{% set bibtexKey = (resource | mBibtexKey | first) is not empty ? (resource | mBibtexKey) : '' %}
{{ bibtexType }}{{ '{' }}{{ bibtexKey }},
{% for metadataName in metadataToDisplay %}  {% set metadata = metadata(metadataName) %}
{% if metadata
and metadata.control != 'display-strategy'
and metadata.control != 'wysiwyg-editor' %}{% set metadataValue = resource | metadata(metadata.id) | onlyMetadataInCurrentLanguage(metadata) | join((' ' ~ ('and' | trans) ~ ' ')) %}
{{ metadata.label | default(metadata.label | first) | inCurrentLanguage | default(metadata.name) | replace({" ": ''}) }} = {{ metadataValue | bibtexEscape | raw }},
{% endif %}
{% endfor %}
}
